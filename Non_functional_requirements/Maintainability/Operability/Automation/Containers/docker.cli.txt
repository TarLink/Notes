
            
   DOCKER   
            



VERSION ==>                       #1.12.3

docker version                    #Prints current version

OS ==>                            #Built on top of LXC, so only run on Linux
                                  #However, on Mac or Windows, installation tools create virtual machine (using Hyper-V)


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           CONCEPTS            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


IMAGE                             #Stateless filesystem snapshot, with metadata
                                  #IMAGE from Docker Hub.
                                  #Pulled unless cached
                                  #Is either:
                                  #  - IMAGE_ID:
                                  #     - SHA256 content hash
                                  #  - [HOSTNAME/][REPO_USER/]IMAGE_NAME[:TAG][@sha256:HASH]:
                                  #     - def HOSTNAME: registry-1.docker.io
                                  #     - REPO_USER (if push|pull, def: docker): see Docker Hub
                                  #     - IMAGE_NAME: [[:alnum:]._-]
                                  #     - def TAG: latest
                                  #     - HASH: content hash
CONTAINER                         #Running instance of an image
                                  #Is either:
                                  #  - CONTAINER_ID UUID
                                  #  - CONTAINER_NAME


ID                                #Can always be shortened

GOTMP                             #Go template, taking an OBJ as input
                                  #Has extra available FUNC:
                                  #  - join ARR
                                  #  - json VAL
                                  #  - lower|upper|title STR
                                  #  - split STR "CHAR"


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:        BEST PRACTICES         :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


MEMORY AND SWAP ACCOUTING ==>     #  - must be enabled on the OS: performance impact, but better OS memory management
                                  #  - see online doc for how to enable it

CONTAINERS BEST PRACTICES ==>     #Containers should:
                                  #  - make it easy to scale:
                                  #     - be ephemeral, i.e. can be immediately stopped at any time
                                  #  - keep it small:
                                  #     - only include necessary packages
                                  #     - limit number of layers
                                  #  - decouple:
                                  #     - only one purpose/process per container


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:          MAIN FILES           :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


DOCKERDIR                         #Runtime directory for docker with notably:
                                  #  - containers/CONTAINER_ID/:
                                  #     - log files
                                  #     - config, including routing
                                  #  - images/
                                  #  - volumes/: data volumes
                                  #  - swarm/: swarm state
                                  #  - tmp/: can choose different dir with ENVVAR DOCKER_TMPDIR
                                  #Def: /var/lib/docker/
dockerd ...
--exec-root DOCKERDIR             #For container state
-g DOCKERDIR
--graph DOCKERDIR                 #For images

DOCKERPIDFILE                     #PID of dockerd. Def: /var/run/docker.pid
dockerd ...
-p PIDFILE
--pidfile PIDFILE                 #

                                  
DOCKERHOME                        #~/.docker/
docker ...  
--config=DOCKERHOME [COMMAND]     #Overrides
                                  #If COMMAND, only overrides for docker COMMAND
DOCKER_CONFIG                     #ENVVAR to override DOCKERHOME

DOCKERCONF                        #Either:
                                  #  - docker --config=FILE
                                  #  - DOCKERHOME/config.json


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:              OCI              :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


OCI ==>                           #Docker is built on top of "Open containers", using containerd
dockerd ...
--containerd FILE                 #Path to containerd socket
--default-runtime NAME            #OCI-compatible runtime (like runC)
                                  #Can also use DOCKERCONF.default-runtime NAME
--add-runtime NAME=PATH           #Adds OCI-compatible runtime
                                  #Can also use DOCKERCONF.runtimes.NAME:
                                  #  - path PATH
                                  #  - runtimeArgs STR_ARR
--exec-opt VAR=VAL                #Options passed to OCI runtime, e.g.
                                  #  - native.cgroupdriver systemd or cgroupfs (def)


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            SERVER             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


CLIENT-SERVICE ARCHITECTURE ==>   #Client is connected to server (daemon)
                                  #Server can bind to (according to -H):
                                  #  - unix:///PATH: Unix socket (def):
                                  #     - owned by dockerd --group|-G GROUP (def: 'docker') if it exists, "root" (avoid) otherwise
                                  #        - i.e. "docker" group user will have full dockerd access
                                  #  - tcp://HOST[:PORT][/PATH]: TCP:
                                  #     - usually port 2375 if no TLS, 2376 if TLS
                                  #     - PATH will be prepended to all requests
                                  #  - fd://[NUM]: systemd socker
                                  #Def: unix:///var/run/docker.sock
                                  #Server must be run as root (see below)
dockerd|docker ...
-H ...                            #Address server listens to, or client connects to
--host ...                        #Can be used multiple times
DOCKER_HOST                       #ENVVAR to override host


DOCKERCONF.HttpHeaders.VAR        #HTTP header named VAR, value VAL, to add, i.e. always sent by client to server


dockerd                           #Starts server
                                  #Can change binary path with ENVVAR DOCKERD
                                  #There is support for:
                                  #  - SysVInit: e.g. start (once) with: sudo service docker start
                                  #  - systemd: e.g. start (at each boot) with: sudo systemctl enable docker
                                  #  - upstart
DOCKER_OPTS                       #Extra flags passed to dockerd
--config-file DOCKEDCONF          #JSON config file (def: /etc/docker/daemon.json) to pass extra flags to dockerd
                                  #Cannot be in conflict with options passed on the CLI
                                  #Flags that can appear several times use plural name, e.g. --label STR -> "labels" STR_ARR
                                  #Can be reloaded by sending SIGHUP to dockerd:
                                  #  - only for --debug, --labels, --live-restore, --max-concurrent-* and 


/etc/default/docker               #File read when using SysVInit or upstart, usually setting ENVVAR


MULTIPLE SERVERS ==>              #To run multiple servers on a single host, must be separated from each other using these
                                  #options (documented elsewhere in this doc):
                                  #  - --bridge, --host, --iptables, --tls*: for networks
                                  #  - --exec-root, --graph, --pidfile: for filesystem
                                  #  - --config-file: for config


dockerd ...
--api-cors-header STR             #Sets Access-Control-Allow-Origin [S] (def: no CORS enabled), so that client can be on different host than server


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           REST API            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/



DOCKER_API_VERSION                #ENVVAR to specify which version to use (def: latest)


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           DEBUGGING           :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


dockerd|docker ...
-D
--debug                           #
-l STR
--log-level=STR                   #

SIGUSR1                           #When sent to server, current stack traces will be logged


docker info ???


DOCKER_NOWARN_KERNEL_VERSION      #ENVVAR to remove warning when Linux kernel version is not compatible



                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            EVENTS             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/



docker events ???


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           BUILDING            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


IMAGE/CONTAINERS ==>              #Are basically a tree of files, with metadata (e.g. COMMANDs)
                                  #Image/containers are basically the same except:
                                  #  - order: container is last layer, images all others
                                  #  - write operations:
                                  #     - when writing to a file, use first layer (starting with container) where this file exists
                                  #     - container is read-write, i.e. normal operation
                                  #     - images are read-only, copy-on-write: copy the file (applying modification to it) to topmost layer (i.e. container)
                                  #  - git commit transform container into image

BUILD LAYERS ==>                  #Works in layers:
                                  #  - each layer only contains modification from parent image
                                  #  - parent images are read-only, shared by reference
                                  #     - uses "storage drivers" (see above)
                                  #  - layers are images or containers
                                  #Each Dockerfile instruction (docker build) or commit (docker commit) creates a new layer:
                                  #  - intermediate IMAGE are removed at the end:
                                  #     - unless docker build --rm=false
                                  #     - can force with docker build --force-rm
                                  #  - each layer creates a new shell, e.g. $PWD will be reset 
                                  #     - should limit number of layers, i.e. combine instructions as much as possible
                                  #  - max 127 layers
                                  #  - prefer Dockerfile over commit

BUILD CACHE ==>                   #Each layer + next instruction is cached:
                                  #  - by def reused if matched
                                  #  - specified in output log "Using cache"
                                  #Invalidates cache:
                                  #  - ADD|COPY of new|newer files
                                  #     - i.e. should be as late as possible, in order to invalidate fewer cache
                                  #  - ARG with different value
                                  #Does not invalidate cache:
                                  #  - COMMANDs, even if takes input from some global/changing state (e.g. apt-get update)
                                  #  - this can create problem, but can be disabled with docker build --no-cache


docker build DIR|URL|-            #Creates an IMAGE from a DIR with a Dockerfile inside.
                                  #URL can be:
                                  #  - Dockerfile
                                  #  - DIR
                                  #  - .tar[.xz|bz2|gz] archive
                                  #  - Git repo URL[#TAG|BRANCH|HASH_ID][:SUBPATH]: using git clone --depth 1 --recursive
                                  #- is stdin:
                                  #  - must be a Dockerfile
                                  #  - can be compressed with .tar[.xz|bz2|gz]
                                  #Non-0 exit code if fails
-f DOCKERFILE                     
--file DOCKERFILE                 #
-q
--quiet                           #


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:          DOCKERFILE           :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


DOCKERFILE                        #Main configuration file, with commands below
                                  #Def: BUILD_DIR/Dockerfile, or docker build -f DOCKERFILE
                                  #Can concanate several Dockerfiles into one


# COMMENT                         #

# escape=CHAR                     #Changes escape character (def: \)
                                  #Can use escaped newlines, and should use them to sort long list alphabetically (e.g.  packages)
                                  #Must be at top of file, before any instruction, comment or blank line


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            IMAGES             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker commit CONTAINER [IMAGE]   #Creates a new (or copies to an) IMAGE, from an existing CONTAINER

-a AUTHOR
--author AUTHOR                   #
-m COMMIT_MESSAGE
--message COMMIT_MESSAGE          #

-c COMMAND
--change COMMAND                  #Execute Dockerfile command

-p false                          #Do not temporaly pause the CONTAINER (if it's running).
--pause false                     #Pausing is done to avoid data corruption while docker commit is ongoing


docker build DIR|URL              #Creates an IMAGE from a DIR with a Dockerfile inside. See above


docker diff CONTAINER ???


docker history IMAGE ???


docker rmi IMAGE                  #Deletes an IMAGE
-f
--force                           #Deletes even if there are related containers
--no-prune                        #Do not delete parents without tags


docker images                     #Prints images with information (one line per image+tag combination):
                                  #  - IMAGE (repository)
                                  #  - tag
                                  #  - sha256 checksum (if --digests)
                                  #  - image ID (truncated unless --no-trunc)
                                  #  - ctime
                                  #  - size
-a
--all                             #Prints all (do not hide intermediate images)
-q
--quiet                           #Only show image ID
--format GOTMP                    #Input is OBJ:
                                  #  - Repository IMAGE
                                  #  - Tag
                                  #  - Digest
                                  #  - ID IMAGE_ID
                                  #  - CreatedSince|At
                                  #  - Size
                                  #Def is DOCKERCONF.imagesFormat "GOTMP"


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:             TAGS              :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker tag IMAGE IMAGE2           #Make IMAGE2 a link to IMAGE, i.e.:
                                  #  - IMAGE_ID IMAGE_NAME: gives a name
                                  #  - IMAGE IMAGE:TAG: create tag
                                  #  - IMAGE REPO_USER/IMAGE_NAME: associate with a repository
docker build ...
-t IMAGE2                         
--tag IMAGE2                      #Performs docker tag IMAGE_ID IMAGE2 after creating IMAGE


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           COMMANDS            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


COMMAND                           #Means a CLI command, either:
                                  #  - same syntax as in a CLI
                                  #     - run with /bin/sh -c, i.e. subcommand (unless COMMAND is "exec ...")
                                  #        - subcommands are not terminated when parent is (e.g. with docker stop)
                                  #        - can be changed with SHELL ["COMMAND",...]
                                  #     - only uses escape character for escaped newlines
                                  #  - as JSON array ["STR",...]
                                  #     - run with exec, i.e. same shell (not subcommand)
                                  #     - does not do shell expansion (e.g. $VAR)
                                  #     - preferred
                                  #Different timing:
                                  #  - build-time: during docker build, e.g. RUN
                                  #  - runtime: during docker exec, e.g. "default command|argument" (ENTRYPOINT|CMD)

RUN COMMAND                       #Dockerfile instruction. Run command

ENTRYPOINT COMMAND                #Dockerfile instruction. If COMMAND uses:
                                  #  - CLI syntax: like CMD
                                  #  - JSON array syntax: sets default command, that can take args
                                  #Only last ENTRYPOINT will be used.
                                  #At least one CMD or ENTRYPOINT required per Dockerfile
docker create ...
--entrypoint COMMAND              #Overrides|specifies ENTRYPOINT (+ related CMD)

CMD COMMAND                       #Dockerfile instruction. If ENTRYPOINT was:
                                  #  - not called before: sets default command, that cannot take args. 
                                  #  - called before: 
                                  #     - sets default args
                                  #     - both ENTRYPOINT and CMD must use JSON array syntax
                                  #Only last CMD will be used.
                                  #At least one CMD or ENTRYPOINT required per Dockerfile


docker exec CONTAINER COMMAND     
 [ARGS...]                        #See below


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            ENVVAR             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


$VAR                              #Expands in Dockerfile. Defined by ENV or ARG
${VAR}                            #Should not be used for confidential information, as docker history shows it
${VAR:-VAL}
${VAR:+VAL}                       #Like in Bash


ENV VAR VAL                       #Dockerfile instruction. Sets ENVVAR
                                  #E.g. to append to $PATH
ENV VAR=VAL ...                   #Can be used as $VAR in following instructions, except:
                                  #  - COMMAND-related: CMD, RUN, ENTRYPOINT, SHELL, HEALTHCHECK
                                  #  - ARG
                                  #  - MAINTAINER
                                  #The first form does not parse/expanse VAL
docker create ...
-e ENVVAR=VAL
--env ENVVAR=VAL                  #Overrides|specifies ENV
--env-file FILE                   #Same with newline-separated ENVVAR=VAL file


ARG VAR[=VAL]                     #Dockerfile instruction. Like ENV, but as build argument, using docker build --build-arg VAR=VAL
                                  #VAL is default value
                                  #Information is not persisted in final built IMAGE. If needs to persist, can put ARG variable inside an ENV
docker build ...
--build-arg VAR=VAL               #Provides ARG


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:          FILESYSTEM           :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


BUILD CONTEXT ==>                 #Directories:
                                  #  - BUILD_DIR: 
                                  #     - specified by docker build
                                  #     - if targetting a Dockerfile directly (e.g. using stdin), no BUILD_DIR
                                  #  - CONTEXT_DIR: temporary, copied from BUILD_DIR
                                  #  - IMAGE_DIR: when image is created
                                  #CONTEXT_DIR:
                                  #  - sent by client to server:
                                  #     - should keep it minimal
                                  #  - can be used by Dockerfile instructions: COPY|ADD, COMMANDs
                                  #     - path resolution:
                                  #        - absolute path: relative to CONTEXT_DIR
                                  #        - relative path: 
                                  #           - relative to current dir, which is initially CONTEXT_DIR
                                  #           - can be changed by WORKDIR (see below)
                                  #  - copied from BUILD_DIR:
                                  #     - minus files matching BUILD_DIR/.dockerignore:
                                  #        - recommended
                                  #        - newline-separated, similar to .gitignore
                                  #        - # COMMENT, first line only
                                  #        - globbing: * ? ** !


WORKDIR DIR                       #Dockerfile instruction. Changes $PWD in CONTEXT_DIR for following instructions
                                  #DIR created with mkdir -p if not existing
                                  #Prefer over "cd"
                                  #Avoid relative DIR
                                  #Def: /
docker create ...
-w DIR
--workdir DIR                     #Overrides|specifies WORKDIR


ONBUILD [...]                     #Dockerfile instruction. Same as ... but delayed: 
                                  #  - fired when another Dockerfile calls FROM for this image
                                  #  - only for direct children, not grandchildren
                                  #Allows using CONTEXTDIR of downstream image
                                  #Can see list of delayed instructions with docker inspect ("OnBuild")

COPY|ADD SRC... DEST              #Dockerfile instruction. Copy files from CONTEXT_DIR to IMAGE_DIR
COPY|ADD ["SRC",..., "DEST"]      #SRC:
                                  #  - can contain globbing * ?
                                  #  - cannot be outside of CONTEXT_DIR
                                  #DEST:
                                  #  - must include trailing / if want to copy inside DIR
                                  #  - if not existing, is created using mkdir -p
                                  #New files/directories created with dockerd user/group (permission-wise)
                                  #ADD has extra features:
                                  #  - SRC can be URL
                                  #  - SRC can be a *.tar (unless it is a URL), which is unpacked

docker cp                         #Copy files recursively:
[CONTAINER:]PATH [CONTAINER:]PATH2#  - permissions are kept
                                  #  - user|group owner is container's user (if in container), current user|group (otherwise)
                                  #CONTAINER must be specified in one (and only one) of either source|dest
                                  #PATH can be - for stdin, which can be .tar archive
                                  #PATH in containers is relative to BUILD_DIR
-L
--follow-link                     #Follow symlinks, i.e. copy symlink target, not symlink itself


docker export CONTAINER ???       


docker import FILE|URL [IMAGE]    #FILE|URL can be - for stdin


docker load ???


docker save IMAGE... ???


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:     ISOLATION/NAMESPACES      :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker build|create ...
--isolation STR                   #Underlying isolation technology among:
                                  #  - process: OCI
                                  #  - hyperv: Hyper-V (virtual machines)
                                  #  - default (def): "process" on Linux, "hyperv" on Windows


FILESYSTEM ==>                    #Container cannot read nor write parent filesystem
                                  #Can remove filesystem isolation for specific directory/files with volumes or --device


PROCESS ==>                       #Each container uses its own "PID namespace", i.e. process list specific to that container:
                                  #  - cannot see parent's
                                  #  - each container starts with PID 1
docker create ...
--pid STR                         #Set container's PID namespace:
                                  #  - "host": same as host's (i.e. no isolation)
                                  #  - "container:CONTAINER": same as another container
                                  #Def: new one


IPC ==>                           #Each container uses its own "IPC namespace", i.e. list of semaphores, queues and shared memory segments
docker create ...
--ipc STR                         #Same value as --pid


NETWORK ==>                       #Each container uses its own:
                                  #  - network interfaces:
                                  #     - see --network "host" to remove isolation
                                  #  - "UTS namespace", i.e. its own hostname
docker create ...
--uts STR                         #Set container's UTS namespace:
                                  #  - "host": same as host's (i.e. no isolation)


USERS/GROUPS ==>                  #"User namespaces": each container uses its own list of users/groups:
                                  #  - i.e. container root user does not have to map to host's root user
                                  #  - /etc/subuid and /etc/subgid show sub-users|groups that current user|group can create as
                                  #    newline-delimited ranges: USER|GROUP:MIN_ID:MAX_ID
                                  #Disabled by default
                                  #Conflicts with docker create:
                                  #  - --pid|network host
                                  #  - --privileged, unless --userns host
                                  #  - --read-only
dockerd ...
--userns-remap                    #Enables user namespaces
 [USER|UID[:GROUP|GID]]           #Uses specified host's USER. Def: USER "dockremap", which is created if not existing
docker create ...                 #Same value as --pid
--userns STR                      #Using --userns host nullifies --userns-remap


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            LIMITS             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker create|build ...
--ulimit NAME=NUM[:NUM2]          #Sets ulimit.
                                  #NUM is soft limit, NUM2 hard limit.
dockerd ...
--default-ulimit ...              #Default for docker create --ulimit


CONTROL GROUPS ==>                #Ensures for each process (i.e. container), at kernel level:
                                  #  - resource (e.g. CPU, memory, I/O) limiting
                                  #  - resource prioritization, e.g. one container should get more CPU
                                  #  - logging/monitoring #  - freezing processes
                                  #Security-wise: this mitigates DDoS, etc.
                                  #Can be hierarchical
                                  #Limitations:
                                  #  - automatically creates a control group
                                  #     - --cgroup-parent uses a specific control group instead
                                  #  - NUM can be -1, i.e. infinity (usually def)

dockerd ...                       #Assigns a specific control group to the container. 
docker create|build ...           #If /CGROUP, is under root cgroup. If CGROUP, is under daemon cgroup
--cgroup-parent CGROUP            #Def: /docker for fs cgroup, system.slice for systemd cgroup

docker create|build ...
-m NUM[b|k|m|g]
--memory=NUM[b|k|m|g]             #Memory hard limit. Min: 4M.
--memory-swap=NUM[b|k|m|g]        #Memory + Swap hard limit
                                  #Def: double of --memory
                                  #When set, --memory must be set
docker create ...
--memory-reservation=NUM[b|k|m|g] #Memory soft limit (i.e. only hint, but not enforce limit)
                                  #If 0 (def), same as --memory
--kernel-memory=NUM[b|k|m|g]      #Memory hard limit, but only the one used by kernel (includes sockets buffer, process stack, slabs).
                                  #Min: 4M.
                                  #When set, --memory must be set
--oom-kill-disable=BOOL           #Enable OOM killer (def: true)
                                  #OOM (out-of-memory) killer: 
                                  #  - kernel terminates a process (here the container) that requested memory while none is either available or above memory hard limit
                                  #  - disabling OOM killer for the container does not disable host's OOM killer
                                  #     - i.e. it might dangerously force killing host's system processes, unless --memory is set
--oom-score-adj=-1000-1000        #Sets OOM preference, i.e. container with lower preference will be first to be OOM killed
                                  #Can be set with dockerd as well
--memory-swappiness=0-100         #How much memory pages should be swapped to cache (as opposed to not cached)
                                  #Def: from host, usually 60
                                  #0: no swap, i.e. bad latency (cannot read any cache), but better throughput (no writing caching)
                                  #100: always swap, i.e. inverse

docker create|build ...
-c NUM 
--cpu-shares=NUM                  #CPU shares:
                                  #  - relative weight between containers
                                  #     - e.g. containers with twice more than other containers get twice more CPU
                                  #     - distributed among running containers, i.e. idle containers are ignored
                                  #  - def: 1024. Min: 2.
--cpu-period=NUM                  #Similar to CPU shared but from an OS process scheduler perspective:
--cpu-quota=NUM                   #  - --cpu-period is scheduler frequency (in ms, def: 100)
                                  #  - CPU shares is --cpu-quota / --cpu-period (def: same as 1 / number of containers)
                                  #Wheras --cpu-shares distribute CPU between containers, --cpu-period|quota limits host's CPU to each container
--cpuset-cpus=RANGE               #Only allow specific CPUs, as RANGE of index, e.g. 0-3 or 0,2
--cpuset-mems=RANGE               #Same for memory nodes (MEMs), which is only used on NUMA systems

docker create ...
--blkio-weight=10-1000            #Block IO weight:
                                  #  - relative weight between containers, i.e. like --cpu-shares but for I/O
                                  #  - only for direct block IO (not buffered block IO)
                                  #Def: 500
--blkio-weight-device=
 DEVICE_PATH:10-1000              #Same but for a specific device, e.g. /dev/sda
--device-read|write-bps=
 DEVICE_PATH:NUM[kb|mb|gb]        #Limit read|write rate from a device, as byte/sec
--device-read|write-iops=
 DEVICE_PATH:NUM                  #Same but as operation/sec
--io-maxbandwidth NUM
--io-maxiops NUM                  #System partition IO limits (Windows only)

docker create|build ...
--shm-size=NUM[b|k|m|g]           #Size of /dev/shm (device that can be mounted as tmpfs, i.e. like /tmp but for IPC)
                                  #Def: 64MB


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:             USERS             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


DAEMON USER ==>                   #Server must be run as root (see below), so must be sure to protect "docker" group

CONTAINER USER ==>                #Different from host's:
                                  #  - containers uses "user namespaces" (see above)
                                  #Containers usually do not require root access:
                                  #  - default user is root
                                  #  - so should use unprivileged user (see USER above)
                                  #Containers are always unprivileged:
                                  #  - can do apt-get install -y
                                  #  - but apt-get upgrade will fail on some core packages
                                  #  - apt-get update:
                                  #     - on its own, creates cache problems (avoid)
                                  #     - creates non-predictability unless pinning version, e.g. apt-get install -y PACKAGE=VERSION
                                  #     - recommended: apt-get update && apt-get install + version pinning && rm -rf /var/lib/apt/lists/*

USER STR                          #Dockerfile instruction. Sets current user, used:
                                  #  - in following instructions, e.g. COMMANDs
                                  #  - runtime, i.e. docker exec
docker create|exec ...
-u USER|UID[:GROUP|GID]
--user USER|UID[:GROUP|GID]       #

CONTAINER GROUP ==>               #
docker create ...
--group-add GROUP                 #Add GROUP to container's user's groups


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           SECURITY            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


CONTAINER CAPABILITIES ==>        #Capabilities are kernel features available to container's control group.
                                  #Most capabilities are disabled by default
                                  #See online doc for list of capabilities
docker create ...                 #Add|remove capabilities
--cap-add|drop VAL                #Can be ALL, for all capabilities but MKNOD
docker create|exec ...
--privileged                      #Add most capabilities


docker create ...
--security-opt="no-new-privileges"#Do not allow adding privileges, e.g. through sudo


dockerd ...
--selinux-enabled                 #Enable SELinux
docker create ...
--security-opt=
 "label=user|role|type|level:VAL"
--security-opt="label=disable"    #SELinux options

docker create ...
--security-opt="apparmor=PROFILE" #Apparmor options

docker create ...
--security-opt=
 "seccomp=unconfined"             
--security-opt="seccomp=PROFILE"  #Seccomp options


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:          HEALTHCHECK          :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


HEALTHCHECK [--OPT] CMD COMMAND   #Dockerfile instruction. Adds a "health status" to a CONTAINER, in addition to its running status:
                                  #  - checked by COMMAND at regular intervals
                                  #  - COMMAND exit code must be 0 (success) or 1 (failure)
                                  #  - COMMAND stdout|stderr will be kept in logs
                                  #Can be inspected with:
                                  #  - docker inspect, ps, etc.
                                  #  - health_status event (with "docker events")
                                  #Used by:
                                  #  - swarm (to maintain number of replicas)
                                  #Only last HEALTHCHECK will be used
--interval=NUM                    #Def: 30 (in secs)
--timeout=NUM                     #Def: 30 (in secs)
--retries=NUM                     #Def: 3

docker create ...
--no-healtcheck                   #Overrides HEALTHCHECK
--health-cmd CMD
--health-interval NUM
--health-timeout NUM
--health-retries NUM              #Overrides|specifies HEALTHCHECK


dockerd ...
--cluster-opts                    #Frequency of healthchecks to nodes, in overlay network
 discovery.heartbeat=NUM          #In secs, def: 20 
--cluster-opts discovery.ttl=NUM  #How long before a node is considered unhealthy by healthcheck, in overlay network
                                  #In secs, def: 60


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:             EXIT              :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker create ...
--restart STR                     #What happens when container exits:
                                  #  - "no" (def): nothing
                                  #  - "always": restarts
                                  #  - "on-failure[:NUM]": restarts if exit code non-0, with NUM max retries (def: unlim)
                                  #  - "unless-stopped": restarts unless explicitely stopped by admin
                                  #Restarts use exponential delay
                                  #Should not be used if a process manager is used, e.g. systemd, forever or pm2
docker run ...
--rm                              #When exiting, remove:
                                  #  - volumes, except if specific VOLUME_NAME was given
                                  #  - container filesystem
                                  #Pros: clean up space
                                  #Cons: cannot inspect them after container exit (for debugging)
                                  #Cannot be used with --detach


docker exec EXIT CODE ==>         #Is:
                                  #  - 125: dockerd error
                                  #  - 126: cannot run COMMAND
                                  #  - 127: cannot find COMMAND
                                  #  - otherwise: COMMAND exit code


dockerd ...
--live-restore                    #Do not shut down containers if server goes down
                                  #Server must be restarted with same options
                                  #While down, clients will buffer communication to server until limit (def: 64K)
                                  #Not compatible with swarm mode


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:        STREAMS/SIGNALS        :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker exec ...
-d                                #Run in the background of current terminal
--detach                          #Returns container ID
                                  #Container exits when COMMAND exits
--detach-keys "KEY,..."           #Sequence of keys to put currently foreground container to background
                                  #Def: "ctrl-p,ctrl-q"
                                  #Can also use DOCKERCONF.detachKeys STR

docker create|exec ...
-t
--tty                             #Allocate a pseudo-TTY. Required if starting interactive shell
-i
--interactive                     #Keep stdin opened even if --detach. Should be used for interactive shells

docker create ...
-a stdin|stdout|stderr            #Redirects COMMAND's standard streams to|from current process|terminal
--attach stdin|stdout|stderr      #Can be done several time. Def: all

docker attach CONTAINER           #Bring container foreground, either:
                                  #  - it is in background in current terminal|process
                                  #  - it is running in another terminal|process, e.g. several terminals can attach to same container
--no-stdin                        #Brings stdout|stderr in foreground, but not stdin
--detach-keys                     #Like docker exec


docker run|attach ...
--sig-proxy=false                 #Do not redirect all signals from current process|terminal to the container it runs

STOPSIGNAL SIG_NAME|NUM           #Dockerfile instruction. Sets signal sent to container to terminate it (def: SIGKILL)


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:        CONTAINER CRUD         :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/



docker create IMAGE               #Does:
 [COMMAND [ARGS...]]              #  - if does not exist locally, docker pull IMAGE
                                  #  - creates a container, using IMAGE

--name CONTAINER_NAME             #Def: random
--cidfile FILE                    #Write CONTAINER_ID to FILE


docker rename CONTAINER CONTAINER2#


docker update CONTAINER...        #


docker rm CONTAINER               #Deletes a CONTAINER
-f
--force                           #Deletes even if running


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:       CONTAINER RUNNING       :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker exec CONTAINER COMMAND     
 [ARGS...]                        #Run COMMAND from within the container (def: container's default command/arguments)


docker run IMAGE [...]            #Does:
                                  #  - docker create IMAGE
                                  #  - docker exec CONTAINER ...
                                  #Shares all options from docker create+exec, plus extra, following.


docker stop|restart CONTAINER...  #Stops a running CONTAINER
                                  #If restart, runs docker start right after
-t INT
--time INT                        #How long to wait (in secs, def: 10)


docker start CONTAINER...         #Runs a stopped CONTAINER


docker kill CONTAINER... ???


docker pause CONTAINER... ???


docker unpause CONTAINER... ???


docker wait CONTAINER... ???

                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:        CONTAINER STATS        :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker ps                         #Prints containers with information:
                                  #  - container ID (truncated unless --no-trunc)
                                  #  - container names
                                  #  - IMAGE name
                                  #  - IMAGE command
                                  #  - ctime
                                  #  - status: exited (+ status code, time)
                                  #  - ports forwarding
                                  #    Can also use: docker port CONTAINER [HOST_PORT]
                                  #  - size (real, virtual): only if -s/--size
-a                                
--all                             #Prints all (not only currently running)
-n [INT]
--last [INT]
-l
--latest                          #Only prints INT (def: 1) latest ran
-q
--quiet                           #Only show container ID
--format GOTMP                    #Def is DOCKERCONF.psFormat "GOTMP"


docker top CONTAINER              #Prints running processes of a container: UID, PID, parent PID, time, command, TTY, etc.


docker stats CONTAINER...         #Prints runtime metrics of containers: CPU, Memory, I/O


docker inspect 
 CONTAINER|IMAGE|TASK             #Prints verbose debug information, as JSON



                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           NETWORKS            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


Look again at "Network configuration" Docker documentation???

dockerd ...
--default-gateway[-v6] IP         #Daemon's (not NETWORK) gateway IP


NETWORK                           #Is a set of network-related settings/resources (ports, etc.)
                                  #Can be the ID (can be truncated) or name
                                  #Default:
                                  #  - three available: none, host, bridge
                                  #  - bridge is the default associated NETWORK
                                  #Containers can:
                                  #  - be associated with several networks

DRIVER                            #Can be bridge, macvlan or overlay

BRIDGE ==>                        #Single-host inter-container communication, with single gateway
                                  #Hosts uses ethernet interface:
                                  #  - docker0 is used for the default bridge interface
                                  #  - automatically creates gateway (external single IP for the subnet)
                                  #Container uses ethernet interface:
                                  #  - called eth0, or docker network create ... -o "com.docker.network.bridge.name=NAME"
                                  #  - uses one IP among host's single subnet
                                  #     - def: automatic, with 2^16 possible IP addresses
dockerd ...
-b INTERFACE
--bridge INTERFACE                #Instead of docker0. Can be "none" (e.g. if NETWORK bridge is not used)
--bip CIDR                        #Sets docker0's IP and netmask
--fixed-cidr[-v6] CIDR            #Sets docker0's subnet

MACVLAN ==>                       #Similar to bridge, but different design, which is more performant and simpler
                                  #  - while in bridge, containers have their own interface and MAC, in macvlan, they use sub-interfaces of the host's interface
                                  #Containers must use same interface as host:
                                  #  - specified with NETWORK option parent=INTERFACE

OVERLAY ==>                       #Multi-host inter-container communication, with single gateway ("advertiser")
                                  #  - connected together using a key-value store
                                  #  - hosts must have unique hostnames
                                  #Key-value store:
                                  #  - supported: consul, etcd, zookeeper
                                  #  - must open ports 4789 (UDP) and 7946 (TCP/UDP)
                                  #Can have multiple subnets (by specifying several --subnet)
                                  #OPT:
                                  #  - encrypted: use IPSec (port 50 must be opened)
                                  #With swarm:
                                  #  - does not need key-value store
                                  #  - can be assigned to SERVICE, which will be applied to every node using the SERVICE
dockerd ...
--cluster-opts kv.path=PATH       #Namespace to prepends to all keys in key-value store
                                  #Def: docker/nodes
--cluster-store PROVIDER://URL    #
--cluster-advertise IP:PORT       #Advertiser
--cluster-store-opts 
 OPT_VAR=OPT_VAL,...              #


docker network create NETWORK_NAME#Creates NETWORK

-d DRIVER
--driver DRIVER                   #Def: bridge
-o VAL                            #DRIVER-specific options
--opt VAL                         #DRIVER name is included in VAL
                                  #Note:
                                  #  - those options are for new NETWORK, not default ones
                                  #  - there usually are corresponding flags for default NETWORK
                                  #     - e.g. --ip-masq is for default bridge NETWORK, -o "com.docker.network.bridge.enable_ip_masquerade" for custom ones

--internal                        #No external access
--ipv6                            #Allows IPv6
--subnet=IP/MASK                  #Specifies subnet (instead of default)
--gateway=IP                      #Specifies gateway (instead of default)
--ip-range=IP/MASK                #Specifies IP range, i.e. subset of subnet from which containers IPs will be picked (def: whole subnet)
--aux-address="VAR=IP"            #Specifies secondary address

dockerd ...
--ipv6                            #Like docker network create ...

docker network create ...
-o "com.docker.network.bridge.
 enable_ip_masquerade"  
dockerd ...                       #Enable IP masquerading, i.e. containers do not have to have a public IP to communicate outside of NETWORK: 
--ip-masq                         #they will use host's IP instead
--ip-forward                      #Enable IP forwarning

docker network create ...
-o "com.docker.network.
 driver.mtu=NUM"
dockerd ...
--mtu NUM                         #Set the containers network MTU (max packet size) (def: 1500)

docker network create ...
-o "com.docker.network.bridge.
 enable_icc=BOOL"
dockerd ...
--icc BOOL                        #Enable|disable communication between containers


docker network rm NETWORK         #


docker network connect NETWORK
 CONTAINER                        #Associate a CONTAINER to a NETWORK
docker network connect ...
--ip[6] IP                        
docker create ...
--ip[6] IP                        #Specifies Ethernet interface's IP (instead of random one from subnet)
--link-local-ip IP                #Same for link local IP
--mac-address STR                 #Same for MAC address
                                  #Incompatible with --network host|CONTAINER
-h HOST                           #Specifies hostname (see UTS namespace above)
--hostname HOST                   #Incompatible with --network CONTAINER

docker create ...
--network STR                     #Associate to network STR:
                                  #  - none: no networking
                                  #  - host: 
                                  #     - same as host's
                                  #     - i.e. less isolation (insecure) but much faster
                                  #  - CONTAINER: same as container's
                                  #  - bridge: create and use new NETWORK of type "bridge"
                                  #  - NETWORK: use existing one


docker network disconnect NETWORK
 CONTAINER                        #Dissociate a CONTAINER to a NETWORK
-f
--force                           #Even if running container


docker network ls                 #Prints available networks: ID, name, driver, scope
-q
--quiet                           #Only show IDs
--no-trunc                        #Do not truncate IDs


docker network inspect NETWORK    #Prints verbose debug information, as JSON


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:              DNS              :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


DNS ==>                           #When inter-container communication is possible, can use DNS names, within same NETWORK:
                                  #  - CONTAINER_NAME:
                                  #     - providing it is not the default bridge NETWORK
                                  #  - DNS_ALIAS: see below

docker network connect ...
--link CONTAINER2:DNS_ALIAS
docker create 
--link CONTAINER2:DNS_ALIAS       #One CONTAINER defines DNS_ALIAS to refer to another CONTAINER2

docker network connect ...        #One CONTAINER2 tells any other CONTAINER the DNS_ALIAS to refer to itself
--alias DNS_ALIAS                 #Several containers can have same DNS_ALIAS:
docker create ...                 #  - only one will be targeted (always the same, i.e. the first one)
--network-alias DNS_ALIAS         #  - others behave as passive failover

docker create ...                 #Appends STR to /etc/hosts
--add-host=STR                    #Incompatible with --network CONTAINER


DNS SERVER ==>                    #By default, same as host's, but can alternative specify DNS server:
                                  #  - with the following options, which update /etc/resolve.conf
                                  #  - incompatible with --network CONTAINER
docker create ...
dockerd ...
--dns IP                          #
--dns-search DOMAIN               #
--dns-opt OPT                     #


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:             PORTS             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


PORT FORWARDING ==>               #Only works with default NETWORK
                                  #This works with Docker appending rules to iptables
dockerd ...
--iptables=false                  #Do not allow Docker to modify iptables, i.e. must manually modify it to get port forwarding working
--userland-proxy=false            #Disable using hairpin NAT when modifying iptables


docker create ...
-p [HOST_IP:][HOST_PORT:]         #Forward ports
 CONTAINER_PORT[/PROTO]           #*_PORT can be a range of ports instead (def: ephemeral port range, i.e. 32768-61000)
                                  #HOST_IP (def: see all)
                                  #  - can change default with: docker network create ... -o "com.docker.network.bridge.host_binding_ipv4=HOST_IP" or dockerd ... --ip HOST_IP
                                  #PROTO: upd|tcp (def: any)
-P                                
--publish-all                     #Forward any exposed CONTAINER_PORT to a random HOST_PORT (ephemeral port range)

EXPOSE PORT ...                   #Dockerfile instruction. Expose port, for docker create -P
docker create ...
--expose PORT                     #Overrides|specifies EXPOSE


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:              TLS              :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


dockerd|docker ...                #dockerd is for client to authenticate server, docker is inverse
                                  #Should run on port 2376 (instead of default 2375)
--tls                             #Uses TLS for self
--tlsverify                       #Uses TLS for self and other endpoint
                                  #Can also use ENVVAR DOCKER_TLS_VERIFY=1
--tlscacert=FILE                  #Def: public CA list
--tlscert=FILE                    #
--tlskey=FILE                     #

DOCKER_CERT_PATH                  #ENVVAR to override certificates|keys directory


dockerd ...
--cluster-opts kv.cacertfile|
 certfile|keyfile=PATH            #For TLS, with overlay network


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:         DATA VOLUMES          :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


DATA VOLUME ==>                   #Container directory that is connected to host, i.e.:
                                  #  - synced (bidirectional) with a directory of the host
                                  #     - must ensure that operations are atomic (to avoid filesystem conflicts)
                                  #     - several containers can share same host directory, by specifying same HOST_DIR (absolute path or VOLUME_NAME)
                                  #  - not saved in images nor container layers
                                  #     - should be used for any data not meant to be persisted in an image, e.g. temp runtime data
                                  #  - faster performance because do not use storage driver
                                  #HOST_DIR can be:
                                  #  - absolute path: 
                                  #     - specific path, random VOLUME_NAME
                                  #     - cannot be manipulated with "docker volume"
                                  #     - called "bind mount"
                                  #     - can create portability problem (path must exist)
                                  #  - [[:alnum:]_.-] VOLUME_NAME: random path (e.g. somewhere in DOCKERDIR), specific VOLUME_NAME
                                  #  - nothing: random path, random VOLUME_NAME
                                  #CONTAINER_DIR: absolute path
                                  #Instead of DIR can also be FILE:
                                  #  - similar to hardlink
                                  #  - but inode must not changed (e.g. mv, sed -i, vim)
DATA VOLUME DRIVER ==>            #Plugin for specific filesystems (e.g. over the network)
                                  #Def: "local"


docker create ...
-v [HOST_DIR:]CONTAINER_DIR[:OPT] #Creates data volume.
                                  #OPT:
                                  #  - ro|rw (def: rw): read-only|write (in container, not in host)
                                  #Can be done several times
--volume-driver=DRIVER            #
--volumes-from CONTAINER          #Uses same -v configuration as CONTAINER


docker rm
-v
--volumes                         #Removes volumes as well


docker volume create              #Creates data volume

--name VOLUME_NAME                #

-d DRIVER
--driver DRIVER                   #
-o OPT=VAL
--opt OPT=VAL                     #Driver-specific options

VOLUME CONTAINER_DIR ...          #Dockerfile instruction
VOLUME ["CONTAINER_DIR",...]      #Similar to -v CONTAINER_DIR with docker create, but build-time


docker volume rm VOLUME_NAME      #


docker volume ls                  #Prints available volumes: DRIVER, VOLUME_NAME
-q
--quiet                           #Only prints names


docker volume inspect VOLUME_NAME #Prints verbose debug information, as JSON


docker service create
--mount ATTR=VAL                  #Uses a data volume in a SERVICE. ATTR are:
                                  #  - type volume (def) + src VOLUME_NAME
                                  #  - type bind + src HOST_DIR
                                  #  - dst CONTAINER_DIR
                                  #  - volume-driver DRIVER
                                  #  - volume-opt OPT=VAL
                                  #  - readonly


docker create ...
--tmpfs CONTAINER_DIR[:OPT]       #Similar to data volumes, but with a tmpfs partition (i.e. uses RAM not host's filesystem)
                                  #OPT are mount options, e.g. rw, noexec, nosuid or size


docker create ...
--device=                         #Similar to volumes, but for devices (e.g. /dev/sda)
 HOST_PATH:CONTAINER_PATH[:OPT]   #OPT (def: 'rwm') are:
                                  #  - 'r' (read)
                                  #  - 'w' (write)
                                  #  - 'm' (mknod), i.e. create /dev/*


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:        STORAGE DRIVER         :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


STORAGE DRIVER ==>                #Filesystem, handling image/container layers
                                  #Def: AUFS
                                  #Is mounted on an existing filesystem, "backing" (i.e. DOCKERDIR's)
dockerd                           #Store driver are per daemon. Can be inspected with docker info
--storage-driver=DRIVER           #Among: overlay2, aufs, btrfs, devicemapper, vfs, zfs
DOCKER_DRIVER                     #ENVVAR to override storage DRIVER
--storage-opt VAR=VAL             #DRIVER-specific options

CHOICE ==>                        #In summary:
                                  #  - AUFS: def, good for general purpose or many containers, bad if big files or lots of write
                                  #  - OverlayFS: similar to AUFS but faster and less stable
                                  #  - ZFS: good if many containers, less stable
                                  #  - BTRFS: good for pools of images, bad if many containers or many small/sequential writes
                                  #  - DeviceMapper: good for big files, bad if many containers
                                  #  - VFS: debugging only
AUFS ==>                          #Only with backing filesystem ext4, XFS or ZFS
                                  #Some Linux distributions do not include AUFS support, because not in Linux kernel
                                  #Features:
                                  #  - good memory use. Fast container startup. I.e.:
                                  #     - good if many containers, e.g. PaaS or general purpose
                                  #  - file-level copy-on-write (CoW) i.e. store entire files, not file diffs, i.e.:
                                  #     - bad for big files
                                  #     - bad if lots of write, because slow CoW
                                  #  - some kernel syscalls are unsupported, which might cause problems:
                                  #     - "rename": copy and unlink instead, i.e. different inode
                                  #     - "open": open("FILE", O_RDONLY) (no CoW) then open("FILE", O_RDWR) (CoW) point to different files
                                  #Union filesystem (union mount, merging layers directories)
OVERLAYFS ==>                     #Only with backing filesystem ext4 or XFS
                                  #Seen as successor of AUFS, but not completely stable yet
                                  #Union filesystem
                                  #Similar features than AUFS, but faster
ZFS ==>                           #Only with backing filesystem ZFS
                                  #Not completely stable
                                  #Features:
                                  #  - good memory use, i.e.:
                                  #     - good if many containers, e.g. PaaS
                                  #  - bad RAM usage
                                  #Storage options: see online doc
BTRFS ==>                         #Only with backing filesystem BTRFS
                                  #Features:
                                  #  - good overall performance
                                  #     - good for pools of images
                                  #  - good support for SSD drives
                                  #  - no page (i.e. part of a file) caching, i.e.:
                                  #     - bad for many containers, e.g. PaaS
                                  #  - writes can increase memory usage and fragmentation quite a lot, i.e.:
                                  #     - bad if many small writes (including changing containers running states)
                                  #  - use journaling, i.e.
                                  #     - bad performance if writes are sequential
                                  #Storage options:
                                  #  - min_space NUM[K|M|G]: minimum subvolume size
DEVICEMAPPER ==>                  #Only with backing filesystem direct-lvm
                                  #Features:
                                  #  - works with 64KB blocks not files
                                  #     - i.e. good for big files, bad for small files
                                  #  - not memory efficient
                                  #     - bad for many containers, e.g. PaaS
                                  #Storage options: see online doc
VFS ==>                           #Only for debugging


RAMDISK ==>                       #Not a STORAGE driver, but a filesystem type similar to tmpfs
                                  #When used, need to set ENVVAR DOCKER_RAMDISK


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            LOGGING            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


LOGDRIVER                         #Logging driver. Can be:
                                  #  - none: no logging
                                  #  - json-file (def): JSON appended to file
                                  #  - syslog
                                  #  - journald
                                  #  - awslogs: 
                                  #     - AWS Cloudwatch, using CreateLogStream() and PutLogEvents()
                                  #     - must provide AWS credentials to dockerd using ENVVAR
                                  #  - gcplogs (Google cloud)
                                  #  - splunk
                                  #  - etwlogs (Windows)
                                  #  - gelf (Graylog, logstash)
                                  #  - fluentd
                                  #LOGDRIVER options:
                                  #  - json-file, syslog, others:
                                  #     - labels VAR,...
                                  #        - if a container has LABEL VAR, adds it (and its value) to every log
                                  #     - env VAR,...
                                  #        - same for ENVVAR
                                  #     - tag GOTMP:
                                  #        - how CONTAINER_ID is printed (def: first 12 chars)
                                  #        - with OBJ: ID (first 12 chars), FullID, Name, Image[Full]ID|Name, DaemonName
                                  #  - json-file:
                                  #     - max-size NUM[k|m|g]: log rotation
                                  #     - max-file NUM: log rotation
                                  #  - awslogs:
                                  #     - awslogs-region REGION
                                  #     - awslogs-group STR
                                  #     - awslogs-stream STR
                                  #  - others: see online doc

docker create ...                 #
dockerd ...                       #
--log-driver LOGDRIVER            #Sets LOGDRIVER
--log-opt VAR=VAL                 #LOGDRIVER options
                                  #Can be done several times

dockerd ...
--raw-logs                        #Do not use colors


docker logs CONTAINER             #Prints logs of a container (i.e. stdout/stderr)
                                  #Only available for LOGDRIVER json-file and journald

-t
--timestamps                      #Print timestamps too
--details                         #Verbose

--tail NUM                        #Only last NUM lines
--since DATE[TIME]                #
-f
--follow                          #Pipe input, i.e. does not end



                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            LABELS             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


LABEL ==>                         #Metadata on images, containers, daemons, volumes, networks, swarm nodes or swarm services
                                  #Can be viewed with docker inspect


LABEL VAR="VAL" ...               #Dockerfile instruction
                                  #Sets labels (metadata). Can override.
                                  #It is recommended to do one pair per line (using trailing newlines)
docker create ...
-l VAR="VAL"
--label VAR[=VAL]                 #Sets labels
--label-file FILE                 #Same from newline-delimited file, which can include # COMMENTS

docker volume|network|service 
 create, dockerd, docker build ...
--label VAR[=VAL]                 #Sets labels

docker node|service update ...
--label-add VAR[=VAL]             #Sets labels
--label-rm VAR                    #Unsets labels


MAINTAINER NAME <EMAIL>           #Dockerfile instruction. Metadata about author


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:           REGISTRY            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/



GOAL ==>                          #Repository (similar to GitHub) of Docker images
                                  #Can create/edit via website.

docker login [HOSTNAME]           #Authenticate to Docker Hub from CLI
                                  #Used when trying to push to repo
                                  #Save credentials at DOCKERCONF.auths.URL.auth "HASH"
-p PASSWORD
--password PASSWORD
-u USER
--user USER                       #Def: use interactive prompt


docker logout [HOSTNAME]          #


docker push IMAGE                 #Push IMAGE to associated repo. IMAGE must include "REPO_USER/"


docker pull IMAGE                 #Pull IMAGE from associate repo. IMAGE must include "REPO_USER/"
-a
--all-tags                        #Pull all related tags as well

FROM IMAGE                        #Dockerfile instruction. Pull another IMAGE, and use it as base
                                  #Must be first instruction. Mandatory.
                                  #Can be done several times (will merge several IMAGEs) but should avoid
                                  #Prefer Docker official images
                                  #"scratch" is special IMAGE, most minimal possible
docker build ...
--pull                            #Never use cache


dockerd ...
--max-concurrent-downloads|uploads
 NUM                              #Max parallel HTTP requests with docker pull|push


docker search STR                 #Searches DockerHub, and prints results: name, description, stars, 
--limit NUM                       #
--no-trunc                        #Do not truncate description


DEFAULT REGISTRY ==>              #Is Docker Hub, maintained by Docker
                                  #Can customize with:
                                  #  - dockerd --registry-mirror HOSTNAME
                                  #  - using HOSTNAME in docker login, etc.


dockerd ...
--insecure-registry HOST[:PORT]   #Must be used when custom registry does not use TLS, or HOSTNAME/ca.crt not available
--disable-legacy-registry         #Do not allow custom registries with old versions of registry protocol


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:         CONTENT TRUST         :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/



CONTENT TRUST ==>                 #Verifying Docker registry (like Docker Hub) images tags (i.e. their connection to hash content) with TLS signatures ("trusted images")
                                  #  - for docker push|pull and docker build|create
                                  #  - bypassed if IMAGE contains HASH
                                  #  - bypassed if no TAG (except for pull, which uses "latest" by default)
                                  #  - signing is automatically done by docker
                                  #     - creates keys in DOCKERHOME/trust/
                                  #     - passphrases can be provided in interactive shell or using ENVVAR DOCKER_CONTENT_TRUST_ROOT|REPOSITORY_PASSPHRASE
DOCKER_CONTENT_TRUST=1            #ENVVAR that must be enabled
docker push|pull|build|create
--disable-content-trust           #

DOCKER_CONTENT_TRUST_SERVER       #ENVVAR to override URL


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:             SWARM             :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


CONCEPTS ==>                      #Swarm:
                                  #  - cluster of nodes
                                  #  - does: load balancing, high availability, basic orchestration
                                  #Node:
                                  #  - is a dockerd server
                                  #  - can be:
                                  #     - manager: 
                                  #        - manages workers:
                                  #           - orchestration
                                  #           - assigning tasks to nodes
                                  #        - managers must be connected to each other, to be able to tell each others' state:
                                  #           - must use datastore for this, if it is multi-host
                                  #     - worker: 
                                  #        - execute a task
                                  #        - managers are also workers:
                                  #           - unless availability is "drained"
                                  #           - should use resource constraints to ensure tasks do not keep manager so busy it cannot do orchestration
                                  #  - leader:
                                  #     - single manager that execute operations
                                  #        - other managers only forward to leader
                                  #     - election/quorum:
                                  #        - other managers only purpose is to possibly be elected to leader:
                                  #           - more increase fault tolerance
                                  #           - but more decrease performance
                                  #        - triggered when leader is down
                                  #           - uses a raft consensus determines a new leader, i.e. (n/2)+1 majority
                                  #           - for it to work, there should be odd number of managers
                                  #        - also used on add|remove nodes or swarm updates
                                  #     - swarm is down when there is less than (n-1)/2 (because election cannot happen)
                                  #        - "down" means there is no leader, i.e.:
                                  #           - cannot manage workers (assigning tasks, orchestration)
                                  #           - but workers keep running
                                  #Service:
                                  #  - template of a task, i.e. an IMAGE + COMMAND + configuration (e.g. number of containers)
                                  #Task:
                                  #  - a CONTAINER execution
                                  #  - once assigned, cannot move to another node
                                  #  - automatically load balanced between nodes
                                  #Those ports must be opened:
                                  #  - 2377 (TCP): orchestration
                                  #  - 7946 (TCP+UDP): inter-nodes orchestration
                                  #  - 4789 (TCP+UDP): overlay network

docker swarm init                 #Starts a new single-node swarm
                                  #Current node will be a leader manager
                                  #Fires docker swarm join-token worker

--advertise-addr IP               #Each manager has an advertised IP for:
                                  #  - external, load-balanced communication to the swarm
                                  #  - communicating to manager for orchestration purpose
                                  #By def:
                                  #  - dockerd --swarm-default-advertise-addr IP
                                  #  - def: main IP address and port 2377

--force-new-cluster               #Forces even if there is currently one
                                  #Useful when quorum was lost, and needs to reboot swarm without losing information like services, tasks, nodes


docker swarm update               #Sets swarm options.
                                  #Same options as docker swarm init except:
                                  #  - no --advertise|listen-addr, --force-new-cluster


SWARM_TOKEN                       #Confidential token specific to a swarm, allowing nodes to join it
                                  #There is one for workers, and one for managers
                                  #Can be rotated


docker swarm join HOST:PORT       #Make current node a worker node of a swarm
                                  #HOST is leader's
                                  #PORT is usually 2377
--token SWARM_TOKEN               #


docker swarm join-token           
 worker|manager                   #Prints SWARM_TOKEN and instructions on how to use docker swarm join
-q
--quiet                           #Only prints token
--rotate                          #Changes SWARM_TOKEN


docker swarm leave                #Inverse of docker swarm join. Must be worker node


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:          SWARM NODE           :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker node promote|demote NODE...#Sets NODE to manager or worker


docker node update NODE           #Sets nodes properties

--role worker|manager             #Same as docker node promote|demote

--availability STR                #Can be:
                                  #  - active: running, can get new tasks
                                  #  - pause: running, cannot get new tasks
                                  #  - drain: 
                                  #     - not running, cannot get new tasks
                                  #     - when switching, currently running tasks are transfered to other nodes


docker node rm NODE...            #
--force                           #Forces even if availability is "active"


docker node ls                    #List available nodes
-q
--quiet                           #Only prints IDs


docker node ps NODE|self          #List tasks running on that NODE


docker node inspect NODE|self...  #Print debug information


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:         SWARM SERVICE         :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


SERVICE                           #Either SERVICE_ID (can be truncated) or SERVICE_NAME

docker service create IMAGE       
 [COMMAND [ARGS...]]              #Creates a swarm service, and launches containers on available nodes to support it (if replicas > 0)

-e
--env
-l
--label
--log-driver
--log-opt
--network
-p
--publish
-u
--user
-w
--workdir                         #Like docker create

--name SERVICE_NAME               #

--replicas NUM                    #Number of tasks (i.e. containers) (def: 0), running same IMAGE in parallel
                                  #Will be enforced, e.g. new tasks will be started if one task terminates or fails healthchecks
                                  #Will be balanced:
                                  #  - try to maintain about the same number of tasks per node
                                  #  - only do so when starting new tasks, i.e. does not rebalance tasks when starting new nodes
--mode replicated|global          #If global (def: replicated), --replicas NUM is "1 per node"
                                  #Good for services that must be run on every node, usually not main task, e.g. monitoring

--update-delay TIME               #Delay between updates (docker service update)
                                  #TIME is [NUMh][NUMm][NUMs]
--update-parallelism              #Apply updates to all nodes at same time (as opposed to def serial)
--update-failure pause|continue   #When an update on a single node fails, pauses (def) updates on all nodes
                                  #Running docker service update will restart node


docker service rm SERVICE...      #Removes SERVICE


docker service update SERVICE     #Sets SERVICE options.
                                  #Same options as docker service create but:
                                  #  - --env|label|publish|container-label|mount -> --env|label|publish|container-label|constraint|mount-add|rm
                                  #  - IMAGE [COMMAND [ARGS...]] -> --image IMAGE, --args ...
                                  #  - no --network
                                  #It will restart containers:
                                  #  - for rolling updates, see --update-delay|parallelism


docker service scale SERVIC=NUM...#Changes number of containers, e.g. to scale up|down or to stop
                                  #Same as updating --replicas


docker service ps SERVICE         #Show nodes/containers running the service: ID, name, service, image, current|desired state, node


docker service ls                 #Prints all SERVICE
-q
--quiet                           #Only print SERVICE_ID


docker service inspect SERVICE... #Gives debug information about SERVICE


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:            PLUGINS            :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


docker plugin ...                 #New system replacing DRIVERs (e.g. for volumes, networks, storage, logging), but still experimental

dockerd ...
--authorization-plugin            #


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:        DOCKER COMPOSE         :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/



docker deploy


                                             /=+===============================+=\ 
                                            /  :                               :  \  
                                            )==:         DOCKER CLOUD          :==(   
                                            \  :_______________________________:  /    
                                             \=+===============================+=/


DOCKER CLOUD ???

docker stack config
docker stack deploy
docker stack rm
docker stack services
docker stack tasks
